<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - MAB-BILIS</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        body {
            background: #e8f5e9;
            min-height: 100vh;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 50px;
            background: #2e7d32;
            color: #fff;
        }
        .navbar .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
        }
        .navbar ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        .navbar ul li a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
        }
        .navbar ul li a:hover {
            text-decoration: underline;
        }
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .dashboard-header h1 {
            color: #2e7d32;
            font-size: 32px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-card h3 {
            color: #2e7d32;
            font-size: 36px;
            margin-bottom: 10px;
        }
        .stat-card p {
            color: #666;
            font-size: 16px;
        }
        .section {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .section h2 {
            color: #2e7d32;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .business-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        .business-item:last-child {
            border-bottom: none;
        }
        .business-info h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 5px;
        }
        .business-info p {
            color: #666;
            font-size: 14px;
        }
        .business-actions {
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }
        .btn-approve {
            background: #4caf50;
            color: #fff;
        }
        .btn-approve:hover {
            background: #388e3c;
        }
        .btn-reject {
            background: #f44336;
            color: #fff;
        }
        .btn-reject:hover {
            background: #d32f2f;
        }
        .btn-delete {
            background: #19a62e;
            color: #fff;
        }
        .btn-delete:hover {
            background: #ff0000;
        }
        
        .btn-logout {
            background: #fff;
            color: #2e7d32;
            padding: 8px 16px;
            border: 2px solid #fff;
        }
        .btn-logout:hover {
            background: #43a047;
            color: #fff;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .success-msg {
            color: #388e3c;
            background: #c8e6c9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="logo">MAB-BILIS Admin</div>
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="#" onclick="logout()">Logout</a></li>
    </ul>
</nav>

<div class="container">
    <div class="dashboard-header">
        <h1>Admin Dashboard</h1>
    </div>
    
    <div id="message"></div>
    
    <div class="stats">
        <div class="stat-card">
            <h3 id="totalBusinesses">0</h3>
            <p>Total Businesses</p>
        </div>
        <div class="stat-card">
            <h3 id="approvedBusinesses">0</h3>
            <p>Approved Businesses</p>
        </div>
        <div class="stat-card">
            <h3 id="pendingBusinesses">0</h3>
            <p>Pending Approvals</p>
        </div>
    </div>
    
    <div class="section">
        <h2>Pending Business Approvals</h2>
        <div id="pendingList">
            <!-- Pending businesses will be loaded here -->
        </div>
    </div>
    
    <div class="section">
        <h2>All Businesses</h2>
        <div id="allBusinessesList">
            <!-- All businesses will be loaded here -->
        </div>
    </div>
    
    <div class="section">
        <h2>Tourist Spots Management</h2>
        <div style="margin-bottom: 20px;">
            <button class="btn btn-approve" onclick="showAddSpotForm()">Add New Tourist Spot</button>
        </div>
        <div id="addSpotForm" style="display: none; margin-bottom: 20px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
            <input type="text" id="spotName" placeholder="Spot Name" style="padding: 10px; width: 100%; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <textarea id="spotDescription" placeholder="Description" style="padding: 10px; width: 100%; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            <input type="text" id="spotLocation" placeholder="Location" style="padding: 10px; width: 100%; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <input type="text" id="spotImage" placeholder="Image URL" style="padding: 10px; width: 100%; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
            <button class="btn btn-approve" onclick="addSpot()">Add Spot</button>
            <button class="btn btn-reject" onclick="hideAddSpotForm()">Cancel</button>
        </div>
        <div id="touristSpotsList">
            <!-- Tourist spots will be loaded here -->
        </div>
    </div>
    
    <div class="section">
        <h2>Bookings Management</h2>
        <div id="bookingsList">
            <!-- Bookings will be loaded here -->
        </div>
    </div>
</div>

<script src="app.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user is admin
        if (!isLoggedIn() || !isAdmin()) {
            window.location.href = 'login.html';
            return;
        }
        
        loadDashboard();
    });
    
    function loadDashboard() {
        const businesses = JSON.parse(localStorage.getItem('mab_businesses')) || [];
        
        // Update stats
        document.getElementById('totalBusinesses').textContent = businesses.length;
        document.getElementById('approvedBusinesses').textContent = businesses.filter(b => b.status === 'approved').length;
        document.getElementById('pendingBusinesses').textContent = businesses.filter(b => b.status === 'pending').length;
        
        // Load pending businesses
        const pendingBusinesses = businesses.filter(b => b.status === 'pending');
        const pendingList = document.getElementById('pendingList');
        
        if (pendingBusinesses.length === 0) {
            pendingList.innerHTML = '<div class="empty-state">No pending businesses to approve.</div>';
        } else {
            let html = '';
            pendingBusinesses.forEach(business => {
                html += `
                    <div class="business-item">
                        <div class="business-info">
                            <h3>${business.name}</h3>
                            <p>Owner: ${business.ownerName}</p>
                            <p>Address: ${business.address}</p>
                            <p>Contact: ${business.contactNumber}</p>
                        </div>
                        <div class="business-actions">
                            <button class="btn btn-approve" onclick="approveBusinessById(${business.id})">Approve</button>
                            <button class="btn btn-reject" onclick="rejectBusinessById(${business.id})">Reject</button>
                            <button class="btn btn-delete" onclick="deleteBusinessById(${business.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            pendingList.innerHTML = html;
        }
        
        // Load all businesses
        const allList = document.getElementById('allBusinessesList');
        if (businesses.length === 0) {
            allList.innerHTML = '<div class="empty-state">No businesses registered yet.</div>';
        } else {
            let html = '';
            businesses.forEach(business => {
                const statusClass = business.status === 'approved' ? 'color: #4caf50;' : (business.status === 'pending' ? 'color: #ff9800;' : 'color: #f44336;');
                html += `
                    <div class="business-item">
                        <div class="business-info">
                            <h3>${business.name}</h3>
                            <p>Owner: ${business.ownerName}</p>
                            <p>Address: ${business.address}</p>
                            <p>Status: <strong style="${statusClass}">${business.status}</strong></p>
                        </div>
                        <div class="business-actions">
${business.status === 'pending' ? `
                                <button class="btn btn-approve" onclick="approveBusinessById(${business.id})">Approve</button>
                                <button class="btn btn-reject" onclick="rejectBusinessById(${business.id})">Reject</button>
                            ` : ''}
                            <button class="btn btn-delete" onclick="deleteBusinessById(${business.id})">Delete</button>
                        </div>
                    </div>
                `;
            });
            allList.innerHTML = html;
        }
    }
    
    function approveBusinessById(id) {
        if (confirm('Are you sure you want to approve this business?')) {
            const businesses = JSON.parse(localStorage.getItem('mab_businesses'));
            const index = businesses.findIndex(b => b.id === id);
            if (index !== -1) {
                businesses[index].status = 'approved';
                localStorage.setItem('mab_businesses', JSON.stringify(businesses));
            }
            document.getElementById('message').innerHTML = '<div class="success-msg">Business approved successfully!</div>';
            loadDashboard();
        }
    }
    
    function rejectBusinessById(id) {
        if (confirm('Are you sure you want to reject this business?')) {
            const businesses = JSON.parse(localStorage.getItem('mab_businesses'));
            const index = businesses.findIndex(b => b.id === id);
            if (index !== -1) {
                businesses[index].status = 'rejected';
                localStorage.setItem('mab_businesses', JSON.stringify(businesses));
            }
            document.getElementById('message').innerHTML = '<div class="success-msg">Business rejected!</div>';
            loadDashboard();
        }
    }
    
    function deleteBusinessById(id) {
        if (confirm('Are you sure you want to delete this business? This will also delete all associated products.')) {
            deleteBusiness(id);
            document.getElementById('message').innerHTML = '<div class="success-msg">Business deleted successfully!</div>';
            loadDashboard();
        }
    }
    
    // Tourist Spot Functions
    function showAddSpotForm() {
        document.getElementById('addSpotForm').style.display = 'block';
    }
    
    function hideAddSpotForm() {
        document.getElementById('addSpotForm').style.display = 'none';
        document.getElementById('spotName').value = '';
        document.getElementById('spotDescription').value = '';
        document.getElementById('spotLocation').value = '';
        document.getElementById('spotImage').value = '';
    }
    
    function addSpot() {
        const name = document.getElementById('spotName').value;
        const description = document.getElementById('spotDescription').value;
        const location = document.getElementById('spotLocation').value;
        const image = document.getElementById('spotImage').value;
        
        if (!name || !location) {
            alert('Please fill in the required fields.');
            return;
        }
        
        addTouristSpot(name, description, location, image);
        document.getElementById('message').innerHTML = '<div class="success-msg">Tourist spot added successfully!</div>';
        hideAddSpotForm();
        loadDashboard();
    }
    
    function deleteSpotById(id) {
        if (confirm('Are you sure you want to delete this tourist spot? This will also delete all associated bookings.')) {
            deleteTouristSpot(id);
            document.getElementById('message').innerHTML = '<div class="success-msg">Tourist spot deleted successfully!</div>';
            loadDashboard();
        }
    }
    
    function loadTouristSpots() {
        const spots = getTouristSpots() || [];
        const spotsList = document.getElementById('touristSpotsList');
        
        if (spots.length === 0) {
            spotsList.innerHTML = '<div class="empty-state">No tourist spots registered yet.</div>';
            return;
        }
        
        let html = '';
        spots.forEach(spot => {
            html += `
                <div class="business-item">
                    <div class="business-info">
                        <h3>${spot.name}</h3>
                        <p>${spot.description}</p>
                        <p>Location: ${spot.location}</p>
                    </div>
                    <div class="business-actions">
                        <button class="btn btn-delete" onclick="deleteSpotById(${spot.id})">Delete</button>
                    </div>
                </div>
            `;
        });
        spotsList.innerHTML = html;
    }
    
    function loadBookings() {
        const bookings = getAllBookings() || [];
        const bookingsList = document.getElementById('bookingsList');
        
        if (bookings.length === 0) {
            bookingsList.innerHTML = '<div class="empty-state">No bookings yet.</div>';
            return;
        }
        
        let html = '';
        bookings.forEach(booking => {
            const spot = getTouristSpotById(booking.spotId);
            const spotName = spot ? spot.name : 'Unknown Spot';
            html += `
                <div class="business-item">
                    <div class="business-info">
                        <h3>${booking.userName}</h3>
                        <p>Spot: ${spotName}</p>
                        <p>Email: ${booking.userEmail}</p>
                        <p>Phone: ${booking.userPhone}</p>
                        <p>Visit Date: ${booking.visitDate}</p>
                        <p>Guests: ${booking.numberOfGuests}</p>
                        <p>Status: <strong>${booking.status}</strong></p>
                    </div>
                    <div class="business-actions">
                        <button class="btn btn-approve" onclick="confirmBookingById(${booking.id})">Confirm</button>
                        <button class="btn btn-delete" onclick="cancelBookingById(${booking.id})">Cancel</button>
                    </div>
                </div>
            `;
        });
        bookingsList.innerHTML = html;
    }
    
    function cancelBookingById(id) {
        if (confirm('Are you sure you want to cancel this booking?')) {
            cancelBooking(id);
            document.getElementById('message').innerHTML = '<div class="success-msg">Booking cancelled successfully!</div>';
            loadDashboard();
        }
    }
    
    function confirmBookingById(id) {
        if (confirm('Are you sure you want to confirm this booking?')) {
            const bookings = JSON.parse(localStorage.getItem('mab_bookings'));
            const index = bookings.findIndex(b => b.id === id);
            if (index !== -1) {
                bookings[index].status = 'confirmed';
                localStorage.setItem('mab_bookings', JSON.stringify(bookings));
            }
            document.getElementById('message').innerHTML = '<div class="success-msg">Booking confirmed successfully!</div>';
            loadDashboard();
        }
    }
    
    // Override loadDashboard to include tourist spots and bookings
    const originalLoadDashboard = loadDashboard;
    loadDashboard = function() {
        originalLoadDashboard();
        loadTouristSpots();
        loadBookings();
    };
</script>

</body>
</html>
